@model ProfileViewModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "CV Preview";
}

<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 fw-bold text-uppercase">Curriculum Vitae</h1>
            <p class="text-muted mb-0">Generated from your eRecruitment profile</p>
        </div>
        <div class="d-flex gap-2">
            <a class="btn btn-outline-secondary" asp-action="Profile">
                <i class="fas fa-arrow-left me-1"></i>Back to Profile
            </a>
            <button class="btn btn-primary" onclick="window.print()">
                <i class="fas fa-print me-1"></i>Print / Save as PDF
            </button>
        </div>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-body">
            <section class="mb-4">
                <h2 class="h5 text-primary text-uppercase fw-bold border-bottom pb-2">Personal Details</h2>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled mb-0">
                            <li><strong>Name:</strong> @Model.FirstName @Model.LastName</li>
                            <li><strong>Identity / Passport:</strong> @(string.IsNullOrWhiteSpace(Model.SaIdNumber) ? Model.PassportNumber : Model.SaIdNumber)</li>
                            <li><strong>Date of Birth:</strong> @Model.DateOfBirth?.ToString("dd MMM yyyy")</li>
                            <li><strong>Nationality:</strong> @(Model.IsSouthAfrican ? "South African" : Model.Nationality)</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled mb-0">
                            <li><strong>Email:</strong> @Model.ContactEmail</li>
                            <li><strong>Phone:</strong> @Model.PhoneNumber</li>
                            <li><strong>Address:</strong> @Model.Location</li>
                            <li><strong>Availability:</strong> @(string.IsNullOrWhiteSpace(Model.AvailabilityNotice) ? Model.AvailabilityDate?.ToString("dd MMM yyyy") : Model.AvailabilityNotice)</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section class="mb-4">
                <h2 class="h5 text-primary text-uppercase fw-bold border-bottom pb-2">Professional Summary</h2>
                <p class="mb-0">
                    @if (!string.IsNullOrWhiteSpace(Model.BusinessDetails) || !string.IsNullOrWhiteSpace(Model.ReappointmentConditionDetails))
                    {
                        <text>@(Model.BusinessDetails ?? Model.ReappointmentConditionDetails)</text>
                    }
                    else
                    {
                        <text>Committed public service professional with experience captured throughout this profile.</text>
                    }
                </p>
            </section>

            <section class="mb-4">
                <h2 class="h5 text-primary text-uppercase fw-bold border-bottom pb-2">Work Experience</h2>
                @if (Model.WorkExperience.Any(w => !string.IsNullOrWhiteSpace(w.EmployerName)))
                {
                    foreach (var role in Model.WorkExperience.Where(w => !string.IsNullOrWhiteSpace(w.EmployerName)))
                    {
                        <div class="mb-3">
                            <h3 class="h6 fw-bold mb-1">@role.PositionHeld <small class="text-muted">@role.EmployerName</small></h3>
                            <div class="text-muted mb-1">@role.FromDate?.ToString("MMM yyyy") - @(role.ToDate?.ToString("MMM yyyy") ?? "Present")</div>
                            @if (!string.IsNullOrWhiteSpace(role.Status))
                            {
                                <div>@role.Status</div>
                            }
                            @if (!string.IsNullOrWhiteSpace(role.ReasonForLeaving))
                            {
                                <div class="text-muted small">Reason for leaving: @role.ReasonForLeaving</div>
                            }
                        </div>
                    }
                }
                else
                {
                    <p class="text-muted fst-italic">No work experience recorded.</p>
                }
            </section>

            <section class="mb-4">
                <h2 class="h5 text-primary text-uppercase fw-bold border-bottom pb-2">Education</h2>
                @if (Model.Qualifications.Any(q => !string.IsNullOrWhiteSpace(q.QualificationName)))
                {
                    foreach (var qualification in Model.Qualifications.Where(q => !string.IsNullOrWhiteSpace(q.QualificationName)))
                    {
                        <div class="mb-3">
                            <h3 class="h6 fw-bold mb-1">@qualification.QualificationName</h3>
                            <div class="text-muted">@qualification.InstitutionName</div>
                            <div>@qualification.YearObtained</div>
                            @if (!string.IsNullOrWhiteSpace(qualification.Status))
                            {
                                <div>@qualification.Status</div>
                            }
                        </div>
                    }
                }
                else
                {
                    <p class="text-muted fst-italic">No qualifications recorded.</p>
                }
            </section>

            <section class="mb-4">
                <h2 class="h5 text-primary text-uppercase fw-bold border-bottom pb-2">Languages</h2>
                @if (Model.Languages.Any(l => !string.IsNullOrWhiteSpace(l.LanguageName)))
                {
                    <ul class="list-unstyled mb-0">
                        @foreach (var language in Model.Languages.Where(l => !string.IsNullOrWhiteSpace(l.LanguageName)))
                        {
                            <li>
                                <strong>@language.LanguageName</strong>
                                <span class="text-muted">â€” Speak: @language.SpeakProficiency, Read/Write: @language.ReadWriteProficiency</span>
                            </li>
                        }
                    </ul>
                }
                else
                {
                    <p class="text-muted fst-italic">No language proficiency recorded.</p>
                }
            </section>

            <section class="mb-4">
                <h2 class="h5 text-primary text-uppercase fw-bold border-bottom pb-2">References</h2>
                @if (Model.References.Any(r => !string.IsNullOrWhiteSpace(r.Name)))
                {
                    foreach (var reference in Model.References.Where(r => !string.IsNullOrWhiteSpace(r.Name)))
                    {
                        <div class="mb-2">
                            <div class="fw-semibold">@reference.Name</div>
                            <div class="text-muted small">@reference.Relationship</div>
                            <div>@reference.ContactNumber</div>
                        </div>
                    }
                }
                else
                {
                    <p class="text-muted fst-italic">No references captured. Update your profile to include referees.</p>
                }
            </section>

            <section class="mb-4">
                <h2 class="h5 text-primary text-uppercase fw-bold border-bottom pb-2">Declarations</h2>
                <ul class="list-unstyled mb-0">
                    <li><strong>Disability:</strong> @(Model.HasDisability ? "Declared" : "No")</li>
                    <li><strong>Criminal Record:</strong> @(Model.HasCriminalRecord ? Model.CriminalRecordDetails : "No")</li>
                    <li><strong>Pending Case:</strong> @(Model.HasPendingCase ? Model.PendingCaseDetails : "No")</li>
                    <li><strong>Disciplinary Actions:</strong> @(Model.PendingDisciplinaryCase ? Model.PendingDisciplinaryDetails : "No")</li>
                </ul>
            </section>

            <section>
                <h2 class="h5 text-primary text-uppercase fw-bold border-bottom pb-2">Supporting Information</h2>
                <ul class="list-unstyled mb-0">
                    <li><strong>Business with the State:</strong> @(Model.BusinessWithState ? Model.BusinessDetails : "None declared")</li>
                    <li><strong>Reappointment Conditions:</strong> @(Model.ReappointmentCondition ? Model.ReappointmentConditionDetails : "None")</li>
                    <li><strong>Professional Registration:</strong> @(string.IsNullOrWhiteSpace(Model.ProfessionalInstitution) ? "Not provided" : $"{Model.ProfessionalInstitution} ({Model.ProfessionalRegistrationNumber})")</li>
                </ul>
            </section>
        </div>
    </div>
</div>

@section Styles {
    <style>
        @@media print {
            body {
                -webkit-print-color-adjust: exact;
            }
            .btn, nav, .dashboard-header, .breadcrumb {
                display: none !important;
            }
            .card {
                box-shadow: none !important;
                border: none !important;
            }
        }
    </style>
}
