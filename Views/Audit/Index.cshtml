@model ERecruitment.Web.ViewModels.AuditListViewModel
@{
    ViewData["Title"] = "Audit Log";
}

<div class="container mt-4">
    <!-- Page Header -->
    <div class="dashboard-header mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="display-5 fw-bold mb-2">
                    <i class="fas fa-clipboard-list me-3 text-primary"></i>Audit Log
                </h1>
                <p class="text-muted mb-0">Track all system activities and changes</p>
            </div>
            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                <a class="btn btn-outline-secondary" asp-controller="Admin" asp-action="Dashboard">
                    <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                </a>
            </div>
        </div>
    </div>

    <!-- Search Card -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-light border-bottom">
            <h5 class="mb-0"><i class="fas fa-search me-2"></i>Search Audit Log</h5>
        </div>
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-10">
                    <label for="search" class="form-label visually-hidden">Search</label>
                    <input type="text" 
                           class="form-control form-control-lg" 
                           id="search" 
                           name="search" 
                           value="@Model.Search" 
                           placeholder="Search by actor or action..." />
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        <i class="fas fa-search me-2"></i>Search
                    </button>
                </div>
            </form>
            @if (!string.IsNullOrWhiteSpace(Model.Search))
            {
                <div class="mt-3">
                    <a asp-action="Index" asp-route-page="1" asp-route-pageSize="@Model.PageSize" class="btn btn-sm btn-outline-secondary">
                        <i class="fas fa-times me-1"></i>Clear Search
                    </a>
                    <span class="text-muted ms-2">
                        <i class="fas fa-info-circle me-1"></i>
                        Found @Model.TotalCount result(s) for "@Model.Search"
                    </span>
                </div>
            }
        </div>
    </div>

    <!-- Audit Log Table Card -->
    <div class="card shadow-sm">
        <div class="card-header bg-light border-bottom d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-history me-2"></i>Activity Log
            </h5>
            <span class="badge bg-primary">@Model.TotalCount total entries</span>
        </div>
        <div class="card-body p-0">
            @if (!Model.Items.Any())
            {
                <div class="text-center py-5">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No audit entries found</h5>
                    <p class="text-muted">
                        @if (!string.IsNullOrWhiteSpace(Model.Search))
                        {
                            <span>Try adjusting your search criteria.</span>
                        }
                        else
                        {
                            <span>No activities have been logged yet.</span>
                        }
                    </p>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 20%;">
                                    <i class="fas fa-clock me-2 text-muted"></i>Timestamp
                                </th>
                                <th style="width: 25%;">
                                    <i class="fas fa-user me-2 text-muted"></i>Actor
                                </th>
                                <th style="width: 55%;">
                                    <i class="fas fa-tasks me-2 text-muted"></i>Action
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var entry in Model.Items)
                            {
                                <tr>
                                    <td>
                                        <span class="text-muted small">
                                            @entry.TimestampUtc.ToLocalTime().ToString("MMM dd, yyyy")
                                        </span>
                                        <br>
                                        <strong>@entry.TimestampUtc.ToLocalTime().ToString("HH:mm:ss")</strong>
                                    </td>
                                    <td>
                                        <i class="fas fa-user-circle text-primary me-2"></i>
                                        <strong>@entry.Actor</strong>
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-circle text-success me-2 mt-1" style="font-size: 0.5rem;"></i>
                                            <span>@entry.Action</span>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>

        <!-- Pagination -->
        @if (Model.Items.Any())
        {
            <div class="card-footer bg-light border-top">
                <nav aria-label="Audit log pagination">
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <div class="mb-2 mb-md-0">
                            <span class="text-muted">
                                Showing <strong>@((Model.Page - 1) * Model.PageSize + 1)</strong> to 
                                <strong>@(Math.Min(Model.Page * Model.PageSize, Model.TotalCount))</strong> of 
                                <strong>@Model.TotalCount</strong> entries
                            </span>
                        </div>
                        <ul class="pagination mb-0">
                            @if (Model.Page > 1)
                            {
                                <li class="page-item">
                                    <a class="page-link" 
                                       asp-action="Index" 
                                       asp-route-page="@(Model.Page - 1)" 
                                       asp-route-pageSize="@Model.PageSize" 
                                       asp-route-search="@Model.Search">
                                        <i class="fas fa-chevron-left me-1"></i>Previous
                                    </a>
                                </li>
                            }
                            else
                            {
                                <li class="page-item disabled">
                                    <span class="page-link">
                                        <i class="fas fa-chevron-left me-1"></i>Previous
                                    </span>
                                </li>
                            }

                            @{
                                var totalPages = (int)Math.Ceiling((double)Model.TotalCount / Model.PageSize);
                                var startPage = Math.Max(1, Model.Page - 2);
                                var endPage = Math.Min(totalPages, Model.Page + 2);
                            }

                            @if (startPage > 1)
                            {
                                <li class="page-item">
                                    <a class="page-link" asp-action="Index" asp-route-page="1" asp-route-pageSize="@Model.PageSize" asp-route-search="@Model.Search">1</a>
                                </li>
                                @if (startPage > 2)
                                {
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                }
                            }

                            @for (int i = startPage; i <= endPage; i++)
                            {
                                <li class="page-item @(i == Model.Page ? "active" : "")">
                                    <a class="page-link" asp-action="Index" asp-route-page="@i" asp-route-pageSize="@Model.PageSize" asp-route-search="@Model.Search">@i</a>
                                </li>
                            }

                            @if (endPage < totalPages)
                            {
                                @if (endPage < totalPages - 1)
                                {
                                    <li class="page-item disabled">
                                        <span class="page-link">...</span>
                                    </li>
                                }
                                <li class="page-item">
                                    <a class="page-link" asp-action="Index" asp-route-page="@totalPages" asp-route-pageSize="@Model.PageSize" asp-route-search="@Model.Search">@totalPages</a>
                                </li>
                            }

                            @if (Model.Page * Model.PageSize < Model.TotalCount)
                            {
                                <li class="page-item">
                                    <a class="page-link" 
                                       asp-action="Index" 
                                       asp-route-page="@(Model.Page + 1)" 
                                       asp-route-pageSize="@Model.PageSize" 
                                       asp-route-search="@Model.Search">
                                        Next<i class="fas fa-chevron-right ms-1"></i>
                                    </a>
                                </li>
                            }
                            else
                            {
                                <li class="page-item disabled">
                                    <span class="page-link">
                                        Next<i class="fas fa-chevron-right ms-1"></i>
                                    </span>
                                </li>
                            }
                        </ul>
                    </div>
                </nav>
            </div>
        }
    </div>

    <!-- Info Card -->
    <div class="card mt-4 bg-light">
        <div class="card-body">
            <h6 class="card-title">
                <i class="fas fa-info-circle me-2 text-info"></i>About Audit Log
            </h6>
            <p class="card-text small mb-0">
                The audit log tracks all system activities, including application submissions, status changes, bulk actions, and administrative operations. 
                All entries are timestamped and include the actor who performed the action. This log provides a complete audit trail for compliance and security purposes.
            </p>
        </div>
    </div>
</div>
